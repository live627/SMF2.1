<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>smf:smf-1.1.12</id>
	<version>1.0</version>
	<file name="$boarddir/index.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[* Software Version:           SMF 1.1.11                                          *
]]></search>
			<add><![CDATA[* Software Version:           SMF 1.1.12                                          *
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[$forum_version = 'SMF 1.1.11';
]]></search>
			<add><![CDATA[$forum_version = 'SMF 1.1.12';
]]></add>
		</operation>
	</file>
	<file name="$sourcedir/DumpDatabase.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[* Software Version:           SMF 1.1                                             *
]]></search>
			<add><![CDATA[* Software Version:           SMF 1.1.12                                             *
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[	@ini_set('memory_limit', '128M');
]]></search>
			<add><![CDATA[	if (@ini_get('memory_limit') < 256)
		@ini_set('memory_limit', '256M');
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		header('Content-Type: application/octetstream');
]]></search>
			<add><![CDATA[		header('Content-Type: ' . ($context['browser']['is_ie'] || $context['browser']['is_opera'] ? 'application/octetstream' : 'application/octet-stream'));
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[	@mysql_free_result($result);

	// Probably MyISAM.... and it might have a comment.
]]></search>
			<add><![CDATA[	@mysql_free_result($result);

	// MySQL users below 4.0 can not use Engine
	if (version_compare('4', preg_replace('~\-.+?$~', '', min(mysql_get_server_info(), mysql_get_client_info()))) > 0)
		$schema_type = 'TYPE=';
	else 
		$schema_type = 'ENGINE=';
	
	// Probably MyISAM.... and it might have a comment.
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[	$schema_create .= $crlf . ') TYPE=' . (isset($row['Type']) ? $row['Type'] : $row['Engine']) . ($row['Comment'] != '' ? ' COMMENT="' . $row['Comment'] . '"' : '');
]]></search>
			<add><![CDATA[	$schema_create .= $crlf . ') ' . $schema_type . (isset($row['Type']) ? $row['Type'] : $row['Engine']) . ($row['Comment'] != '' ? ' COMMENT="' . $row['Comment'] . '"' : '');
]]></add>
		</operation>
	</file>
	<file name="$sourcedir/ManageSearch.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[* Software Version:           SMF 1.1.2                                           *
]]></search>
			<add><![CDATA[* Software Version:           SMF 1.1.12                                           *
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[				DROP TABLE IF EXISTS {$db_prefix}log_search_words", __FILE__, __LINE__);

			db_query("
				CREATE TABLE {$db_prefix}log_search_words (
]]></search>
			<add><![CDATA[				DROP TABLE IF EXISTS {$db_prefix}log_search_words", __FILE__, __LINE__);

			// MySQL users below 4.0 can not use Engine
			if (version_compare('4', preg_replace('~\-.+?$~', '', min(mysql_get_server_info(), mysql_get_client_info()))) > 0)
				$schema_type = 'TYPE=';
			else
				$schema_type = 'ENGINE=';

			db_query("
				CREATE TABLE {$db_prefix}log_search_words (
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[				) TYPE=MyISAM", __FILE__, __LINE__);
			
]]></search>
			<add><![CDATA[				) " . $schema_type . "MyISAM", __FILE__, __LINE__);

]]></add>
		</operation>
	</file>
	<file name="$sourcedir/ManageSmileys.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[* Software Version:           SMF 1.1.11                                          *
]]></search>
			<add><![CDATA[* Software Version:           SMF 1.1.12                                          *
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[	void ImportSmileys($smileyPath)
		// !!!
*/
]]></search>
			<add><![CDATA[	void ImportSmileys($smileyPath)
		// !!!

	void EditMessageIcons()
		// !!!

	void sortSmileyTable()
		// !!!
*/
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		$context['smiley_sets'] = explode(',', $modSettings['smiley_sets_known']);

		updateSettings(array(
			'smiley_sets_default' => empty($context['smiley_sets'][$_POST['default_smiley_set']]) ? 'default' : $context['smiley_sets'][$_POST['default_smiley_set']],
			'smiley_sets_enable' => isset($_POST['smiley_sets_enable']) ? '1' : '0',
]]></search>
			<add><![CDATA[		$context['smiley_sets'] = explode(',', $modSettings['smiley_sets_known']);

		// Make sure that the smileys are in the right order after enabling them.
		if (isset($_POST['smiley_enable']))
			sortSmileyTable();

		updateSettings(array(
			'smiley_sets_default' => empty($context['smiley_sets'][$_POST['default_smiley_set']]) ? 'default' : $context['smiley_sets'][$_POST['default_smiley_set']],
			'smiley_sets_enable' => isset($_POST['smiley_sets_enable']) ? '1' : '0',
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[			// Sort all smiley codes for more accurate parsing (longest code first).
			db_query("
				ALTER TABLE {$db_prefix}smileys
				ORDER BY LENGTH(code) DESC", __FILE__, __LINE__);
]]></search>
			<add><![CDATA[			// Sort all smiley codes for more accurate parsing (longest code first).
			sortSmileyTable();
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		// Make sure the smiley codes are still in the right order.
		db_query("
			ALTER TABLE {$db_prefix}smileys
			ORDER BY LENGTH(code) DESC", __FILE__, __LINE__);
]]></search>
			<add><![CDATA[		// Make sure the smiley codes are still in the right order.
		sortSmileyTable();
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		while ($row = mysql_fetch_assoc($request))
			$context['boards'][$row['ID_BOARD']] = $row['name'];
		mysql_free_result($request);
	}
}

?>]]></search>
			<add><![CDATA[		while ($row = mysql_fetch_assoc($request))
			$context['boards'][$row['ID_BOARD']] = $row['name'];
		mysql_free_result($request);
	}
}

// This function sorts the smiley table by code length, it is needed as MySQL withdrew support for functions in order by.
function sortSmileyTable()
{
	global $db_prefix;

	// Add a sorting column.
	db_query("
		ALTER TABLE {$db_prefix}smileys
		ADD temp_order mediumint(8) not null", __FILE__, __LINE__);

	// Set the contents of this column.
	db_query("
		UPDATE {$db_prefix}smileys
		SET temp_order = LENGTH(code)", __FILE__, __LINE__);

	// Order the table by this column.
	db_query("
		ALTER TABLE {$db_prefix}smileys
		ORDER BY temp_order DESC", __FILE__, __LINE__);

	// Remove the sorting column.
	db_query("
		ALTER TABLE {$db_prefix}smileys
		DROP temp_order", __FILE__, __LINE__);
}

?>]]></add>
		</operation>
	</file>
	<file name="$sourcedir/News.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[* Software Version:           SMF 1.1                                             *
]]></search>
			<add><![CDATA[* Software Version:           SMF 1.1.12                                             *
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[	global $db_prefix, $scripturl;

	// Find the most recent members.
]]></search>
			<add><![CDATA[	global $db_prefix, $scripturl;

	if (!allowedTo('view_mlist'))
		return array();

	// Find the most recent members.
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[	if (!loadMemberContext($_GET['u']))
]]></search>
			<add><![CDATA[	if (!loadMemberContext($_GET['u']) || !allowedTo('profile_view_any'))
]]></add>
		</operation>
	</file>
	<file name="$sourcedir/PackageGet.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[* Software Version:           SMF 1.1.11                                          *
]]></search>
			<add><![CDATA[* Software Version:           SMF 1.1.12                                          *
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[			'name' => htmlspecialchars($row['name']),
			'url' => htmlspecialchars($row['url']),
]]></search>
			<add><![CDATA[			'name' => $row['name'],
			'url' => $row['url'],
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		$_POST['serverurl'] = substr($_POST['serverurl'], 0, -1);

]]></search>
			<add><![CDATA[		$_POST['serverurl'] = substr($_POST['serverurl'], 0, -1);
	$servername = htmlspecialchars($_POST['servername']);
	$serverurl = htmlspecialchars($_POST['serverurl']);

	// Make sure the URL has the correct prefix.
	if (strpos($serverurl, 'http://') !== 0 && strpos($serverurl, 'https://') !== 0)
		$serverurl = 'http://' . $serverurl;

]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		VALUES (SUBSTRING('$_POST[servername]', 1, 255), SUBSTRING('$_POST[serverurl]', 1, 255))", __FILE__, __LINE__);
]]></search>
			<add><![CDATA[		VALUES (SUBSTRING('$servername', 1, 255), SUBSTRING('$serverurl', 1, 255))", __FILE__, __LINE__);
]]></add>
		</operation>
	</file>
	<file name="$sourcedir/Subs-Package.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[* Software Version:           SMF 1.1.5                                           *
]]></search>
			<add><![CDATA[* Software Version:           SMF 1.1.12                                           *
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[
		if (trim($lower) <= $version && trim($upper) >= $version)
			return true;
]]></search>
			<add><![CDATA[		$lower = explode('.', $lower);
		$upper = explode('.', $upper);
		$version = explode('.', $version);

		foreach ($upper as $key => $high)
		{
			// Let's check that this is at or below the upper... obviously.
			if (isset($version[$key]) && trim($version[$key]) > trim($high))
				return false;

			// OK, let's check it's above the lower key... if it exists!
			if (isset($lower[$key]))
			{
				// The version either needs to have something here (i.e. can't be 1.0 on a 1.0.11) AND needs to be greater or equal to.
				// Note that if it's a range lower[key] might be blank, in that case version can not be set!
				if (!empty($lower[$key]) && (!isset($version[$key]) || trim($version[$key]) < trim($lower[$key])))
					return false;
			}
		}
		return true;
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[	preg_match('~^(http|ftp)(s)?://([^/:]+)(:(\d))?(.+)$~', $url, $match);
]]></search>
			<add><![CDATA[	preg_match('~^(http|ftp)(s)?://([^/:]+)(:(\d+))?(.+)$~', $url, $match);
]]></add>
		</operation>
	</file>
	<file name="$themes_dir/babylon/Display.template.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[// Version: 1.1; Display
]]></search>
			<add><![CDATA[// Version: 1.1.12; Display
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		$moderationButtons[] = '<a href="' . $scripturl . '?action=removepoll;topic=' . $context['current_topic'] . '.' . $context['start'] . '" onclick="return confirm(\'' . $txt['poll_remove_warn'] . '\');">' . ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/' . $context['user']['language'] . '/admin_remove_poll.gif" alt="' . $txt['poll_remove'] . '" border="0" />' : $txt['poll_remove']) . '</a>';
]]></search>
			<add><![CDATA[		$moderationButtons[] = '<a href="' . $scripturl . '?action=removepoll;topic=' . $context['current_topic'] . '.' . $context['start'] . ';sesc=' . $context['session_id'] . '" onclick="return confirm(\'' . $txt['poll_remove_warn'] . '\');">' . ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/' . $context['user']['language'] . '/admin_remove_poll.gif" alt="' . $txt['poll_remove'] . '" border="0" />' : $txt['poll_remove']) . '</a>';
]]></add>
		</operation>
	</file>
	<file name="$themes_dir/classic/Display.template.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[// Version: 1.1; Display
]]></search>
			<add><![CDATA[// Version: 1.1.12; Display
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		$moderationButtons[] = '<a href="' . $scripturl . '?action=removepoll;topic=' . $context['current_topic'] . '.' . $context['start'] . '" onclick="return confirm(\'' . $txt['poll_remove_warn'] . '\');">' . ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/' . $context['user']['language'] . '/admin_remove_poll.gif" alt="' . $txt['poll_remove'] . '" border="0" />' : $txt['poll_remove']) . '</a>';
]]></search>
			<add><![CDATA[		$moderationButtons[] = '<a href="' . $scripturl . '?action=removepoll;topic=' . $context['current_topic'] . '.' . $context['start'] . ';sesc=' . $context['session_id'] . '" onclick="return confirm(\'' . $txt['poll_remove_warn'] . '\');">' . ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/' . $context['user']['language'] . '/admin_remove_poll.gif" alt="' . $txt['poll_remove'] . '" border="0" />' : $txt['poll_remove']) . '</a>';
]]></add>
		</operation>
	</file>
	<file name="$themedir/Admin.template.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[// Version: 1.1.1; Admin
]]></search>
			<add><![CDATA[// Version: 1.1.12; Admin
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[				sendingElement.blur();
				return false;
			}

			function smfDetermineVersions()
]]></search>
			<add><![CDATA[				sendingElement.blur();
				return false;
			}

			function compareVersions(current, target)
			{
				// Are they equal, maybe?
				if (current == target)
					return false;

				var currentVersion = current.split(".");
				var targetVersion = target.split(".");

				for (var i = 0, n = (currentVersion.length > targetVersion.length ? currentVersion.length : targetVersion.length); i < n; i++)
				{
					// Make sure both are set.
					if (typeof(currentVersion[i]) == "undefined")
						currentVersion[i] = "0";
					else if (typeof(targetVersion[i]) == "undefined")
						targetVersion[i] = "0";

					// If they are same, move to the next set.
					if (currentVersion[i] == targetVersion[i])
						continue;
					// Otherwise a simple comparison...
					else
						return (parseInt(currentVersion[i]) < parseInt(targetVersion[i]));
				}

				return false;
			}

			function smfDetermineVersions()
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[						if ((highYour[versionType] < yourVersion || highYour[versionType] == "??") && !lowVersion[versionType])
]]></search>
			<add><![CDATA[						if ((compareVersions(highYour[versionType], yourVersion) || highYour[versionType] == "??") && !lowVersion[versionType])
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[						if (highCurrent[versionType] < smfVersions[filename] || highCurrent[versionType] == "??")
]]></search>
			<add><![CDATA[						if (compareVersions(highCurrent[versionType], smfVersions[filename]) || highCurrent[versionType] == "??")
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[						if (yourVersion < smfVersions[filename])
]]></search>
			<add><![CDATA[						if (compareVersions(yourVersion, smfVersions[filename]))
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[					else if (yourVersion < smfVersions[filename])
]]></search>
			<add><![CDATA[					else if (compareVersions(yourVersion, smfVersions[filename]))
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[						if ((highYour["Languages"] < yourVersion || highYour["Languages"] == "??") && !lowVersion["Languages"])
]]></search>
			<add><![CDATA[						if ((compareVersions(highYour["Languages"], yourVersion) || highYour["Languages"] == "??") && !lowVersion["Languages"])
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[						if (highCurrent["Languages"] < smfLanguageVersions[filename] || highCurrent["Languages"] == "??")
]]></search>
			<add><![CDATA[						if (compareVersions(highCurrent["Languages"], smfLanguageVersions[filename]) || highCurrent["Languages"] == "??")
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[						if (yourVersion < smfLanguageVersions[filename])
]]></search>
			<add><![CDATA[						if (compareVersions(yourVersion, smfLanguageVersions[filename]))
]]></add>
		</operation>
	</file>
	<file name="$themedir/Display.template.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[// Version: 1.1; Display
]]></search>
			<add><![CDATA[// Version: 1.1.12; Display
]]></add>
		</operation>
		<operation error="ignore">
			<search position="replace"><![CDATA[		'remove_poll' => array('test' => 'can_remove_poll', 'text' => 'poll_remove', 'image' => 'admin_remove_poll.gif', 'lang' => true, 'custom' => 'onclick="return confirm(\'' . $txt['poll_remove_warn'] . '\');"', 'url' => $scripturl . '?action=removepoll;topic=' . $context['current_topic'] . '.' . $context['start']),
]]></search>
			<add><![CDATA[		'remove_poll' => array('test' => 'can_remove_poll', 'text' => 'poll_remove', 'image' => 'admin_remove_poll.gif', 'lang' => true, 'custom' => 'onclick="return confirm(\'' . $txt['poll_remove_warn'] . '\');"', 'url' => $scripturl . '?action=removepoll;topic=' . $context['current_topic'] . '.' . $context['start'] . ';sesc=' . $context['session_id']),
]]></add>
		</operation>
	</file>
	<file name="$languagedir/Manual.english.php" error="skip">
		<operation error="ignore">
			<search position="replace"><![CDATA[Although many forums also have a quick login box to allow you to login direct from any screen, its position on the page may vary considerably from forum to forum. In the SMF default theme, for example, it\'s in the collapsable section at the top, whereas it\'s more likely to be at the bottom in themes based on the older YaBB SE forum.]]></search>
			<add><![CDATA[Although many forums also have a quick login box to allow you to login direct from any screen, its position on the page may vary considerably from forum to forum. In the SMF default theme, for example, it\'s in the collapsible section at the top, whereas it\'s more likely to be at the bottom in themes based on the older YaBB SE forum.]]></add>
		</operation>
	</file>
</modification>